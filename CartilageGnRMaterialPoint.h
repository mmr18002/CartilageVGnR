//
// Created by muhammed on 8/13/20.
//

#pragma once

#include <FECore/FEMaterial.h>
#include <FEBioMech/FEElasticMaterial.h>
#include <FEBioMech/FEFiberMaterialPoint.h>
#include "FECore/FEMaterialPoint.h"


//-----------------------------------------------------------------------------
//! Material point data for Growth and Remodeling MMR20200720
class CartilageGnRMaterialPoint : public FEMaterialPointData
{
public:
    //! constructor
    CartilageGnRMaterialPoint(FEMaterialPointData *pt) : FEMaterialPointData(pt) {}

    //! copy material point data
    FEMaterialPointData* Copy() override;

    //! Initialize material point data
    void Init() override;

    //! Update material point data
    void Update(const FETimeInfo &timeInfo) override;

    //! Serialize data to archive
    void Serialize(DumpStream &ar) override;

    double Volume_Return(FEMaterialPoint& pt, double v_f, float dt, double time_step);

    double Volume_Return_Test(FEMaterialPoint& pt, double v_f, float dt, double time_step);

    double sigmash_stimuli(FEMaterialPoint& pt, float dt);

    double sigma1_stimuli(FEMaterialPoint& pt, float dt);

    double interpolate(vector<double> &xData, vector<double> &yData, double x, bool extrapolate);

//    double interpolate(double *xData, double *yData, double x, bool extrapolate);

    double NewtonRaphsonManual(double (*func)(double, double, double *),
                               double (*deriv)(double, double, double *),
                               double initial, double dt, double tol, double *prev);

public:

    double nvolu; //<! Volume Return

    double n_c; //<! Normalized number of living chondrocytes
    double n_nc; //<! Normalized number of necrotic chondrocytes
    double n_hc; //<! Normalized number of hypertrophic chondrocytes
    double m_co_fn; //<! Normalized quantity of functional collagen II
    double m_co_dm; //<! Normalized quantity of damaged collagen II
    double m_co; //<! Normalized quantity of collagen II
    double m_pg; //<! Normalized quantity of proteoglycan
    double c_ca; //<! Normalized concentration of collagenase (MMPs)
    double c_ag; //<! Normalized concentration of aggrecanase (ADAMTSs)
    double c_i; //<! Normalized concentration of TIMPs
    double c_sm; //<! Normalized concentration of Suramin
    double c_lp; //<! Normalized concentration of latent pro-inflamm. cytokines
    double c_p; //<! Normalized concentration of active pro-inflamm. cytokines
    double c_lbeta; //<! Normalized concentration of latent growth factors
    double c_beta; //<! Normalized concentration of active growth factors

    double f_sigma1; //<! Mechanical stimuli function of 1st principal stress
    double f_sigmash; //<! Mechanical stimuli function of max shear stress



    int iterator_count;     // This is to ensure that the
                            // constituetns get updated once in one time step
    double time_it;

    double time_check;


    // Parameters for Newton-Raphson iteration
    double res;
    double ynew;
    double yi;


//    const double f_sigmash[251] = {
//            0,0,0,0,0,0,0,0,0,0,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.599418232,0.593505637,0.586532811,0.578343671,0.568772765,0.557650394,0.544810184,0.530099404,0.51339204,0.494604205,0.473710802,0.45076165,0.425894626,0.399342993,0.371434307,0.342579204,0.313250018,0.283951143,0.255184902,0.227417703,0.201051225,0.17640218,0.153692348,0.133048598,0.114511059,0.098046758,0.083565929,0.070938609,0.060009809,0.050612274,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653
//    };
//
//    const double f_sigma1[251] = {
//            0,0,0,0,0,0,0,0,0,0,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.602842429,0.599418232,0.593505637,0.586532811,0.578343671,0.568772765,0.557650394,0.544810184,0.530099404,0.51339204,0.494604205,0.473710802,0.45076165,0.425894626,0.399342993,0.371434307,0.342579204,0.313250018,0.283951143,0.255184902,0.227417703,0.201051225,0.17640218,0.153692348,0.133048598,0.114511059,0.098046758,0.083565929,0.070938609,0.060009809,0.050612274,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653,0.047790653
//    };
};
//-------------------------------------------------------------------------------------------------------------------
